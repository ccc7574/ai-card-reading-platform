# ğŸ—„ï¸ AIå¡ç‰‡é˜…è¯»å¹³å° - æ•°æ®åº“è®¾ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨ä¸ºAIå¡ç‰‡é˜…è¯»å¹³å°è®¾ç½®å®Œæ•´çš„Supabaseæ•°æ®åº“ï¼ŒåŒ…æ‹¬è¡¨ç»“æ„ã€å®‰å…¨ç­–ç•¥ã€åˆå§‹æ•°æ®å’Œå‡½æ•°ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºSupabaseé¡¹ç›®

1. è®¿é—® [Supabase](https://supabase.com)
2. åˆ›å»ºæ–°é¡¹ç›®
3. è®°å½•é¡¹ç›®URLå’ŒAPIå¯†é’¥

### 2. æ›´æ–°ç¯å¢ƒå˜é‡

æ›´æ–° `.env.local` æ–‡ä»¶ï¼š

```env
NEXT_PUBLIC_SUPABASE_URL=your_actual_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_actual_supabase_anon_key
```

### 3. æ‰§è¡Œæ•°æ®åº“è„šæœ¬

åœ¨Supabase SQLç¼–è¾‘å™¨ä¸­æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼š

#### æ–¹æ³•ä¸€ï¼šä¸€é”®è®¾ç½®ï¼ˆæ¨èï¼‰
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/setup_database.sql çš„å…¨éƒ¨å†…å®¹
```

#### æ–¹æ³•äºŒï¼šåˆ†æ­¥è®¾ç½®
```sql
-- 1. åˆ›å»ºè¡¨ç»“æ„
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/01_create_tables.sql

-- 2. è®¾ç½®å®‰å…¨ç­–ç•¥
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/02_rls_policies.sql

-- 3. æ’å…¥åˆå§‹æ•°æ®
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/03_seed_data.sql

-- 4. åˆ›å»ºå‡½æ•°å’Œç´¢å¼•
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/04_functions.sql
```

## ğŸ“Š æ•°æ®åº“æ¶æ„

### æ ¸å¿ƒè¡¨ç»“æ„

#### 1. ç”¨æˆ·ç›¸å…³è¡¨
- **user_profiles** - ç”¨æˆ·æ‰©å±•ä¿¡æ¯
- **user_preferences** - ç”¨æˆ·åå¥½è®¾ç½®
- **user_activities** - ç”¨æˆ·æ´»åŠ¨è®°å½•
- **user_achievements** - ç”¨æˆ·æˆå°±

#### 2. å†…å®¹ç›¸å…³è¡¨
- **contents** - æ•°æ®æºå†…å®¹
- **categories** - å†…å®¹åˆ†ç±»
- **tags** - æ ‡ç­¾ç³»ç»Ÿ
- **content_tags** - å†…å®¹æ ‡ç­¾å…³è”

#### 3. AIå¡ç‰‡ç›¸å…³è¡¨
- **cards** - AIç”Ÿæˆçš„å¡ç‰‡
- **card_tags** - å¡ç‰‡æ ‡ç­¾å…³è”

#### 4. äº¤äº’ç›¸å…³è¡¨
- **likes** - ç‚¹èµè®°å½•
- **bookmarks** - æ”¶è—è®°å½•
- **shares** - åˆ†äº«è®°å½•
- **comments** - è¯„è®ºç³»ç»Ÿ

#### 5. ç³»ç»Ÿç›¸å…³è¡¨
- **notifications** - é€šçŸ¥ç³»ç»Ÿ
- **achievements** - æˆå°±å®šä¹‰

### å…³é”®åŠŸèƒ½

#### 1. è¡Œçº§å®‰å…¨ (RLS)
- ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„ç§æœ‰æ•°æ®
- å…¬å¼€å†…å®¹å¯¹æ‰€æœ‰ç”¨æˆ·å¯è§
- ç®¡ç†å‘˜æƒé™æ§åˆ¶

#### 2. è‡ªåŠ¨è§¦å‘å™¨
- æ–°ç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºç”¨æˆ·èµ„æ–™
- æ›´æ–°æ—¶é—´è‡ªåŠ¨ç»´æŠ¤
- ç»Ÿè®¡æ•°æ®è‡ªåŠ¨æ›´æ–°

#### 3. é«˜çº§å‡½æ•°
- **get_recommended_contents()** - ä¸ªæ€§åŒ–æ¨è
- **search_contents()** - å…¨æ–‡æœç´¢
- **get_user_stats()** - ç”¨æˆ·ç»Ÿè®¡
- **update_reading_streak()** - é˜…è¯»è¿ç»­å¤©æ•°
- **check_and_grant_achievements()** - æˆå°±ç³»ç»Ÿ

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

```env
# Supabaseé…ç½®
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key

# AIæœåŠ¡é…ç½®
OPENAI_API_KEY=your-openai-key
GEMINI_API_KEY=your-gemini-key

# åº”ç”¨é…ç½®
NEXT_PUBLIC_APP_URL=http://localhost:3002
NEXT_PUBLIC_DEFAULT_AI_PROVIDER=gemini
```

### æ•°æ®åº“é…ç½®éªŒè¯

æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢éªŒè¯è®¾ç½®ï¼š

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
ORDER BY table_name;

-- æ£€æŸ¥åˆå§‹æ•°æ®
SELECT 'categories' as table_name, count(*) as count FROM categories
UNION ALL
SELECT 'tags', count(*) FROM tags
UNION ALL
SELECT 'contents', count(*) FROM contents;

-- æ£€æŸ¥RLSç­–ç•¥
SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual 
FROM pg_policies 
WHERE schemaname = 'public';
```

## ğŸ“ˆ æ•°æ®åˆå§‹åŒ–

### é¢„ç½®æ•°æ®

æ•°æ®åº“å°†è‡ªåŠ¨åˆ›å»ºä»¥ä¸‹åˆå§‹æ•°æ®ï¼š

#### åˆ†ç±» (6ä¸ª)
- AIæŠ€æœ¯ ğŸ¤–
- äº§å“è®¾è®¡ ğŸ¨
- å•†ä¸šæ´å¯Ÿ ğŸ’¼
- å¼€å‘æŠ€æœ¯ ğŸ’»
- æ•°æ®ç§‘å­¦ ğŸ“Š
- ç”¨æˆ·ä½“éªŒ ğŸ‘¥

#### æ ‡ç­¾ (12ä¸ª)
- AIã€æœºå™¨å­¦ä¹ ã€æ·±åº¦å­¦ä¹ 
- ChatGPTã€äº§å“ç®¡ç†ã€UIè®¾è®¡
- Reactã€Next.jsã€TypeScript
- æ•°æ®åˆ†æã€åˆ›ä¸šã€æŠ•èµ„

#### ç¤ºä¾‹å†…å®¹ (5ç¯‡)
- AIé©±åŠ¨çš„ä»£ç ç”Ÿæˆå·¥å…·é©å‘½
- 2024å¹´äº§å“è®¾è®¡è¶‹åŠ¿é¢„æµ‹
- å•†ä¸šæ¨¡å¼åˆ›æ–°çš„äº”ä¸ªå…³é”®è¦ç´ 
- Next.js 15æ–°ç‰¹æ€§æ·±åº¦è§£æ
- æ•°æ®é©±åŠ¨çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç­–ç•¥

#### æˆå°±ç³»ç»Ÿ (10ä¸ª)
- ä»åˆæ¬¡é˜…è¯»åˆ°å¡ç‰‡å¤§å¸ˆ
- ä¸åŒç¨€æœ‰åº¦ï¼šæ™®é€šã€ç¨€æœ‰ã€å²è¯—ã€ä¼ è¯´

## ğŸ”’ å®‰å…¨é…ç½®

### RLSç­–ç•¥æ¦‚è¿°

1. **ç”¨æˆ·èµ„æ–™** - ç”¨æˆ·åªèƒ½æŸ¥çœ‹å…¬å¼€èµ„æ–™æˆ–è‡ªå·±çš„èµ„æ–™
2. **å¡ç‰‡** - å…¬å¼€å¡ç‰‡æ‰€æœ‰äººå¯è§ï¼Œç§æœ‰å¡ç‰‡ä»…åˆ›å»ºè€…å¯è§
3. **æ´»åŠ¨è®°å½•** - ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ´»åŠ¨
4. **é€šçŸ¥** - ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„é€šçŸ¥
5. **è¯„è®º** - æ‰€æœ‰äººå¯æŸ¥çœ‹ï¼Œä»…åˆ›å»ºè€…å¯ä¿®æ”¹
6. **äº’åŠ¨** - ç‚¹èµã€æ”¶è—ã€åˆ†äº«è®°å½•æœ‰ç›¸åº”æƒé™æ§åˆ¶

### æ•°æ®åº“å‡½æ•°æƒé™

- æ¨èç®—æ³•å‡½æ•°ï¼šæ‰€æœ‰è®¤è¯ç”¨æˆ·å¯è°ƒç”¨
- æœç´¢å‡½æ•°ï¼šæ‰€æœ‰ç”¨æˆ·å¯è°ƒç”¨
- ç»Ÿè®¡å‡½æ•°ï¼šä»…ç”¨æˆ·è‡ªå·±çš„æ•°æ®
- æˆå°±ç³»ç»Ÿï¼šç³»ç»Ÿè‡ªåŠ¨è§¦å‘

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¿æ¥å¤±è´¥
```
Error: Invalid API key
```
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ `.env.local` ä¸­çš„ Supabase URL å’Œ API å¯†é’¥

#### 2. æƒé™é”™è¯¯
```
Error: Row Level Security policy violation
```
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ RLS ç­–ç•¥å·²æ­£ç¡®è®¾ç½®

#### 3. å‡½æ•°è°ƒç”¨å¤±è´¥
```
Error: Function not found
```
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿å·²æ‰§è¡Œ `04_functions.sql` è„šæœ¬

#### 4. è§¦å‘å™¨é”™è¯¯
```
Error: Trigger function does not exist
```
**è§£å†³æ–¹æ¡ˆ**ï¼šæŒ‰é¡ºåºé‡æ–°æ‰§è¡Œæ‰€æœ‰è„šæœ¬

### é‡ç½®æ•°æ®åº“

å¦‚éœ€é‡ç½®æ•°æ®åº“ï¼š

```sql
-- è­¦å‘Šï¼šè¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®ï¼
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO public;

-- ç„¶åé‡æ–°æ‰§è¡Œè®¾ç½®è„šæœ¬
```

## ğŸ“š APIä½¿ç”¨ç¤ºä¾‹

### è·å–æ¨èå†…å®¹

```typescript
const { data, error } = await supabase
  .rpc('get_recommended_contents', {
    user_id_param: userId,
    limit_param: 10
  })
```

### æœç´¢å†…å®¹

```typescript
const { data, error } = await supabase
  .rpc('search_contents', {
    search_query: 'äººå·¥æ™ºèƒ½',
    category_ids: [categoryId],
    sort_by: 'relevance'
  })
```

### è·å–ç”¨æˆ·ç»Ÿè®¡

```typescript
const { data, error } = await supabase
  .rpc('get_user_stats', {
    user_id_param: userId
  })
```

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•è¿æ¥** - ç¡®ä¿åº”ç”¨èƒ½æ­£å¸¸è¿æ¥æ•°æ®åº“
2. **åˆ›å»ºæµ‹è¯•ç”¨æˆ·** - æ³¨å†Œæµ‹è¯•è´¦å·éªŒè¯åŠŸèƒ½
3. **å¯¼å…¥çœŸå®æ•°æ®** - æ›¿æ¢ç¤ºä¾‹æ•°æ®ä¸ºçœŸå®å†…å®¹
4. **æ€§èƒ½ä¼˜åŒ–** - æ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´ç´¢å¼•
5. **ç›‘æ§è®¾ç½®** - é…ç½®æ•°æ®åº“ç›‘æ§å’Œå‘Šè­¦

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æ£€æŸ¥ Supabase é¡¹ç›®æ—¥å¿—
2. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
3. ç¡®è®¤æ•°æ®åº“è„šæœ¬æ‰§è¡Œé¡ºåº
4. æŸ¥çœ‹åº”ç”¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

---

**ğŸ‰ æ•°æ®åº“è®¾ç½®å®Œæˆåï¼Œæ‚¨çš„AIå¡ç‰‡é˜…è¯»å¹³å°å°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼**
