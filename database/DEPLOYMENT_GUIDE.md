# æ•°æ®åº“éƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨Supabaseä¸­éƒ¨ç½²AIå¡ç‰‡é˜…è¯»å¹³å°çš„æ•°æ®åº“æ¶æ„ã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

1. **Supabaseè´¦æˆ·** - åœ¨ [supabase.com](https://supabase.com) æ³¨å†Œ
2. **é¡¹ç›®åˆ›å»º** - åˆ›å»ºä¸€ä¸ªæ–°çš„Supabaseé¡¹ç›®
3. **ç¯å¢ƒå˜é‡** - è·å–é¡¹ç›®çš„URLå’ŒAPIå¯†é’¥

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šè·å–Supabaseå‡­æ®

1. ç™»å½•Supabaseæ§åˆ¶å°
2. é€‰æ‹©æ‚¨çš„é¡¹ç›®
3. è¿›å…¥ `Settings` > `API`
4. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - `Project URL`
   - `anon/public key`
   - `service_role key` (å¯é€‰ï¼Œç”¨äºç®¡ç†æ“ä½œ)

### ç¬¬äºŒæ­¥ï¼šæ›´æ–°ç¯å¢ƒå˜é‡

åœ¨ `.env.local` æ–‡ä»¶ä¸­æ›´æ–°ï¼š

```bash
# Supabaseé…ç½®
NEXT_PUBLIC_SUPABASE_URL=your_project_url_here
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
```

### ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡ŒSQLè„šæœ¬

åœ¨Supabaseæ§åˆ¶å°çš„SQLç¼–è¾‘å™¨ä¸­ï¼ŒæŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æ–‡ä»¶ï¼š

#### 1. åˆ›å»ºè¡¨ç»“æ„
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/01_create_tables.sql çš„å†…å®¹
```

#### 2. è®¾ç½®è¡Œçº§å®‰å…¨ç­–ç•¥
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/02_rls_policies.sql çš„å†…å®¹
```

#### 3. åˆ›å»ºæ•°æ®åº“å‡½æ•°
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/04_functions.sql çš„å†…å®¹
```

#### 4. æ’å…¥ç§å­æ•°æ®
```sql
-- å¤åˆ¶å¹¶æ‰§è¡Œ database/03_seed_data.sql çš„å†…å®¹
```

## ğŸ”§ è‡ªåŠ¨åŒ–éƒ¨ç½² (å¯é€‰)

å¦‚æœæ‚¨æœ‰service role keyï¼Œå¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼š

```bash
# å®‰è£…ä¾èµ–
npm install @supabase/supabase-js

# è¿è¡Œéƒ¨ç½²è„šæœ¬
node scripts/deploy-database.js
```

## âœ… éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆåï¼ŒéªŒè¯ä»¥ä¸‹è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š

### æ ¸å¿ƒè¡¨
- âœ… `users` - ç”¨æˆ·ä¿¡æ¯
- âœ… `cards` - å¡ç‰‡æ•°æ®
- âœ… `data_sources` - æ•°æ®æºé…ç½®
- âœ… `user_preferences` - ç”¨æˆ·åå¥½è®¾ç½®

### åŠŸèƒ½è¡¨
- âœ… `card_interactions` - å¡ç‰‡äº¤äº’è®°å½•
- âœ… `user_achievements` - ç”¨æˆ·æˆå°±
- âœ… `reading_sessions` - é˜…è¯»ä¼šè¯
- âœ… `content_analysis` - å†…å®¹åˆ†æç»“æœ

### ç³»ç»Ÿè¡¨
- âœ… `ai_generation_logs` - AIç”Ÿæˆæ—¥å¿—
- âœ… `data_source_status` - æ•°æ®æºçŠ¶æ€
- âœ… `system_metrics` - ç³»ç»ŸæŒ‡æ ‡

## ğŸ” æµ‹è¯•è¿æ¥

åœ¨åº”ç”¨ä¸­æµ‹è¯•æ•°æ®åº“è¿æ¥ï¼š

```javascript
// æµ‹è¯•ä»£ç 
import { supabase } from '@/lib/supabase'

async function testConnection() {
  const { data, error } = await supabase
    .from('users')
    .select('count')
    .limit(1)
    
  if (error) {
    console.error('æ•°æ®åº“è¿æ¥å¤±è´¥:', error)
  } else {
    console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ!')
  }
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é”™è¯¯**
   - ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„APIå¯†é’¥
   - æ£€æŸ¥RLSç­–ç•¥æ˜¯å¦æ­£ç¡®è®¾ç½®

2. **è¡¨ä¸å­˜åœ¨**
   - ç¡®è®¤SQLè„šæœ¬æ‰§è¡Œé¡ºåºæ­£ç¡®
   - æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

3. **è¿æ¥è¶…æ—¶**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - éªŒè¯Supabaseé¡¹ç›®çŠ¶æ€

### é‡ç½®æ•°æ®åº“

å¦‚æœéœ€è¦é‡æ–°éƒ¨ç½²ï¼š

```sql
-- åˆ é™¤æ‰€æœ‰è¡¨ (è°¨æ…ä½¿ç”¨!)
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;
GRANT ALL ON SCHEMA public TO postgres;
GRANT ALL ON SCHEMA public TO public;
```

## ğŸ“Š æ•°æ®åº“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚    â”‚     cards       â”‚    â”‚  data_sources   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID)       â”‚    â”‚ id (UUID)       â”‚    â”‚ id (UUID)       â”‚
â”‚ email           â”‚    â”‚ title           â”‚    â”‚ name            â”‚
â”‚ name            â”‚    â”‚ summary         â”‚    â”‚ url             â”‚
â”‚ avatar_url      â”‚    â”‚ content         â”‚    â”‚ status          â”‚
â”‚ created_at      â”‚    â”‚ category        â”‚    â”‚ last_updated    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ card_interactionsâ”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ user_id         â”‚
                    â”‚ card_id         â”‚
                    â”‚ interaction_typeâ”‚
                    â”‚ created_at      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ‰ å®Œæˆ

æ•°æ®åº“éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„AIå¡ç‰‡é˜…è¯»å¹³å°å°†å…·å¤‡ï¼š

- âœ… å®Œæ•´çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ
- âœ… å¡ç‰‡å­˜å‚¨å’Œç®¡ç†
- âœ… æ•°æ®æºé…ç½®å’Œç›‘æ§
- âœ… ç”¨æˆ·è¡Œä¸ºåˆ†æ
- âœ… æˆå°±å’Œæ¸¸æˆåŒ–ç³»ç»Ÿ
- âœ… é«˜çº§æœç´¢å’Œæ¨èåŠŸèƒ½

ç°åœ¨å¯ä»¥å¯åŠ¨åº”ç”¨å¹¶å¼€å§‹ä½¿ç”¨å®Œæ•´çš„æ•°æ®åº“åŠŸèƒ½ï¼
